# 高性能MySQL

## 数据结构

### 实数类型

需要额外的空间和计算开销，所以应该尽量只在对小数进行精确计算时才使用DECIMAL——例如存储财务数据。但在数据量比较大的时候，可以考虑使用BIGINT代替DECIMAL，将需要存储的货币单位根据小数的位数乘以相应的倍数即可。假设要存储财务数据精确到万分之一分，则可以把所有金额乘以一百万，然后将结果存储在BIGINT里，这样可以同时避免浮点存储计算不精确和DECIMAL精确计算代价高的问题。

### 字符串类型

#### VARCHAR

##### 额外字节

VARCHAR需要使用1或2个额外字节记录字符串的长度：如果列的最大长度小于或等于255字节，则只使用1个字节表示，否则使用2个字节。假设采用latin1字符集，一个VARCHAR（10）的列需要11个字节的存储空间。VARCHAR（1000）的列则需要1002个字节，因为需要2个字节存储长度信息。

##### 特性

可变长的字符串，节省了存储空间，提升了性能，但是UPDATE时需要执行额外的操作（行占用的空间增长，页内没有更多的空间可以存储，在这种情况下，不同存储引擎的存储方式不同，例如MyISAM会将行拆分成不同的片段存储，InnoDB则会分裂页使得行可以放入页内）

##### 适用情况

字符串列的最大长度比平均长度大很多，列的更新很少，碎片不是问题（例如，使用了UTF-8这样的复杂字符集，每个字符用不同的字节数进行存储）

#### CHAR

##### 适用情况

CHAR适合存储很短的字符串，或者所有值都接近同一个长度。例如，CHAR非常适合存储密码的MD5值，因为这是一个定长的值。对于经常变更的数据，CHAR也比VARCHAR更好，因为定长的CHAR类型不容易产生碎片。对于非常短的列，CHAR比VARCHAR在存储空间上也更有效率。例如用CHAR（1）来存储只有Y和N的值，如果采用单字节字符集只需要一个字节，但是VARCHAR（1）却需要两个字节，因为还有一个记录长度的额外字节。

### 日期和时间类型

### 位数据类型

### 选择标识符（identifier）

### 特殊类型数据

## 索引

索引可以包含一个或多个列的值。如果索引包含多个列，那么列的顺序也十分重要，因为MySQL只能高效地使用索引的最左前缀列。

创建一个包含两个列的索引，和创建两个只包含一列的索引是大不相同的。

### 优点

1. 索引大大减少了服务器需要扫描的数据量。
2. 索引可以帮助服务器避免排序和临时表。
3. 索引可以将随机I/O变为顺序I/O。

## 查询优化

### LIMIT
